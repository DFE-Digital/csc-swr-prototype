<p>This is an example of writing into pouchDB</p>
<p>
  Here, the input field writes into pouch db whenever there is an onchange. 
  Check the console for a success message when writing into the input box
</p>
<%= form_for :example_form, html: {id: "my_form"}, remote: true do |f| %> 
  <%=  f.text_field :hello, id: 'form_input', onchange: 'addItemToDb(this.value);' %>
  <%=  f.submit 'Submit this form', id: 'submit_button' %>
<% end %>


<script>
  // Step 1: Create a new pouch instance
  // The localStorage adapter is support for old browsers, use { adapter: 'localStorage' }
  // as a second argument to instantiation of new pouch
  let localdb = new PouchDB('social_worker_recording_tool_local')
  let remotedb = new PouchDB('http://admin:password@127.0.0.1:5984/social_worker_recording_tool_remote');
  window.addEventListener('load', function() {
    function updateOnlineStatus(event) {
      var condition = navigator.onLine ? "online" : "offline";
      alert(`you are ${condition}`)
    }
    window.addEventListener('online',  updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
  });
  function addItemToDb(text) {
    let visit_note = {
      _id: new Date().toISOString(),
      content: text
    }
    remotedb.put(visit_note, function callback(err, result) {
      if (!err) {
        console.log('Successful addition of visit note into PouchDB!')
      } else {
        console.log(err)
      }
    })
  }

  const sync = localdb.sync(remotedb, {  
    live: true,  
    retry: true  
  });

  // Step 3: replicate to the server
  localdb.replicate.to('http://127.0.0.1:5984/_utils/#/database/mycompany')

  // Step 4: Listen to the changes
  remotedb.changes().on('change', () => {
    console.log('Changes')
  })
</script>